---
layout: single
title: "早几天想更却又迷惑"
date: 2022-12-21T17:17:00+08:00
last_modified_at: 2022-12-21T17:17:00+08:00
author: hedzr
tags: [life]
categories: life style
comments: true
toc: true
header:
  teaser: https://raw.githubusercontent.com/hzimg/blog-pics/master/uPic/image-20211019103247571.png
  overlay_image: /assets/images/3953273590_704e3899d5_m.jpg
  overlay_filter: rgba(16, 16, 32, 0.73)
excerpt: >-
  因为丢失了一组稿子...
---

## 序

早几天就想更新的，但是还在搏斗中，和药，和口罩，和消毒水，和抗原，等等，后来大家都开始了，我已经退出了，就开始设想和实操 macOS 的更新问题。

这一回是保持了好久的 Catalina 后终于又要向上尝试更新了。

上回去 Big Sur 后崩的一塌糊涂就退回了。

这次是长久的 xcode command-line tools 的版本问题，HomeBrew 不断提示不支持，然后很多 apps 也无法更新了，总之不升级仍有一系列的问题会令人不满。

刚好学到了新招数，就准备动手了。

但是只准备到 Monterey，至于 Vertura 就还是留给小白鼠们吧。

## 更新 macOS 系统

新招数是啥哩？其实也没多么奇技，只是利用 macOS APFS 的一个特性，即卷空间动态共享功能。

以前为了看 Linux 代码时候怎么办？就是打开 Disk Utility 创建一个新卷，使能大小写敏感，然后 pull 源代码，vscode 使能 C++Tools Extension 之后就可以看了，等到索引建立完成之后，交叉跳转也基本上没问题，即使有问题，用 Find In Folder 也马马虎虎可以将就了。

### 利用一个新卷

在这里的重点，和 Windows 的硬盘分区知识大不同的地方就是，新的大小写敏感的卷的尺寸是不重要的，或者说无意义的。因为当你在向旧的卷或者新的卷写入文件时，整颗 SSD 的剩余空间都给你用，无所谓是分给哪个卷。

这个能力很重要，但往常我没有进一步去想。

但实际上，在主力机上做大版本升级，就可以利用这个方法，先在一个单独的卷中升级，确认没有问题之后再从 TM 中恢复你的旧数据，或者干脆废弃这个试验用的卷，再来在主力卷中升级安装新系统。

这么做的好处就在于，像上次 Big Sur 时候我的痛苦，根本不必再度经历。

那时候的我也没什么错的，因为以前的大版本升级我可从未遇到过问题，谁忒么知道会遇到一个这么糟糕的 Big Shit 呢。

### 安装概要

现在，我新建一个叫做 `Macintosh NEW` 的卷，下载 Monterey 的 Installer，运行 Installer 并且在指定目标卷的时候不去覆盖我原有的 Catalina 系统，而是写入这个 NEW 的新卷。

等到操作完成之后，要么跟随 installer 提示重启到新卷中，要么在系统设置-启动磁盘中指定我们到新卷为下次启动卷。然后就是重启、准备新系统，进入初装画面。

我很高兴整个过程啥错也没有，就来到了新本本的开机初装画面。这时候就不要传输旧系统，也不恢复旧的 TM 备份，而是完完全全地新装一个 Monterey 系统。

接下来经过了好多天的艰难险阻，安装各种开发要用的东东，准备各种环境，顺便还工作娱乐两不相忘，虚拟机环境也要整理一遍，哦，还有 Docker，为什么不借此机会试试 Podman Desktop 呢，好的，走你。

然后那些下不动包，各种隐晦的环境配置时的错误提示，等等，我又重历了一遍。Now，我只有一个问题，IINA 乱看电影不可以，会崩，呵呵，要严肃，还是回来工作吧。

总之，这次升级简直几乎没有遇到过崩溃重启，顺利来到了新系统。

### Pros

好处至少有两个：

一是 Music 终于直接可以无损了，以前还要凭一支 Android 手机上的 Apple Music 才能获得无损音频，然后想要输出更是麻烦。现在嘛这个基本上不算问题了。

二是 Xcode 及其命令行工具升级之后，连带带来一系列的改进，这方面就不展开了，因为全是很细枝末节的开发技术问题。

三是借着这次重新布置系统，以前的搞乱的东西，比如很多 python 版本，很多 ruby 版本及其渣滓，就清理了一遍，现在就干净多了。

四是借此机会正式废弃了 Android Studio 那一堆东西（包括 SDK，NDK，Emulators），以及 Qt 的那一堆，这些空间保守估计大约能有 100 多 GB，相当合理是不是。

### Cons

因为有两个相似的卷，在配置我的工作环境的过程中，出错若干，常常弄错。

多数情况下做错了尚能恢复，至少可以借助于 TM 备份来恢复。

直到有一回，本来要发出 `rm -rf ~/.config/containers/podman` 命令的，结果 zsh 自动建议出来之后手抖了一下，直接回车而不是完成这个建议提示。于是 iTerm 就执行了我的命令。命令如下：

```bash
rm -rf ~/
```

我甚至没有意识到犯错。

即使意识到，我也不慌，对不对？

可惜这次幸运没有关照我，因为 TM 备份中缺少了一个草稿目录，包括这两月来偶尔有心思码字时的稿件片段。

所以现在我宣布，我确实真的丢了一少少文章，也就几篇吧，由于思路不连续，这些稿子中的内容基本没有可能重新默写出来了。

所以用血与泪来警告读到这里的你，Terminal 很可怕，即使你稳如老鸟，仍然会不知道什么时候就死一回。

我已经平静地接受了，你呢？

## 后记

Ventura 值得吗？

基本上我觉得不值得，除非我买 M3 Max MacBook Pro 的时候，那时候应该是下一代、下下一代了。

macOS 从 Big Sur 起的大版本没有什么核心价值。他们确实搞了很多联动，但是你日常需要的东西统统维持原状，没得改善。

就以 Apple Music 为例，上次听的 Playlist，下次打开 Apple Music 之后你只能重新找到它，不会给你恢复场景，更不会借着上次听的曲目重新开始，你只能再来一遍操作才行。除非你永远不关闭退出 Apple Music。但即使如此也不行，你总得 Restart OS 的吧？

至于空间音频，那就没有啥用。

总的来说，这种大版本，隔代升级一下，还算略微有点意义。至于每次充当小白鼠，我不爱折腾。

## 后后记

自从上次发 post 之后，就被封了，直到这月初 8 号才解。

如“序”所说，那之后继续操心生活问题，买这买那，这两天才缓过来。

但也没有真的缓，同样的紧张，因为外面”好危险“。

作为三年来没有感染的人，何时才到头呢？

从未感染过的人，可能是因为你很自律，更可能是因为你还未碰上最适合你的哪一款。

那一款 variant！

:end:
